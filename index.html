<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Acervo Cultural: 2024 vs 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Cores de Identidade
                        '2025-primary': '#007AFF', // Azul (Ano Atual) - Apple Blue
                        '2024-primary': '#5E5CE6', // Roxo (Ano Anterior) - Apple Purple
                        
                        // Cores de Score
                        'high-score': '#34C759', // Verde para sucesso
                        'mid-high-score': '#FFCC00',
                        'mid-low-score': '#FF9500',
                        'low-score': '#FF3B30',
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            /* Fundo branco suave (quase branco) */
            background-color: #F9F9F9; 
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
            color: #1F2937; 
            position: relative; 
            min-height: 100vh;
        }

        /* Estilo Apple: Cards brancos flutuantes */
        .apple-card {
            background-color: #FFFFFF;
            border: 1px solid #E5E7EB;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.04); /* Sombra suave para levantar o elemento */
            transition: all 0.2s ease-out;
        }

        .apple-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            border-color: var(--tw-colors-2025-primary);
        }
        
        
        .apple-header-text {
            font-weight: 300; /* Light weight */
            color: #1F2937;
        }

      
        .score-10, .score-9 { color: var(--tw-colors-high-score); }
        .score-8, .score-7 { color: var(--tw-colors-mid-high-score); }
        .score-6, .score-5 { color: var(--tw-colors-mid-low-score); }
        .score-4, .score-3, .score-2, .score-1, .score-0, .score-negative { color: var(--tw-colors-low-score); }

        /* Estrela Cheia e Vazia */
        .star-filled { color: #FFC72C; }
        .star-empty { color: #D1D5DB; }

        /* Anima√ß√µes e Placeholders */
        .fade-in { animation: fadeIn 0.8s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { to { opacity: 1; } }
        .slide-up { animation: slideUp 0.8s ease-out forwards; opacity: 0; }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .bar-fill { animation: barFill 1.2s ease-out forwards; opacity: 0; }
        @keyframes barFill { to { opacity: 1; } }
        .animated-item { opacity: 0; transform: translateY(20px); transition: all 0.6s ease-out; }
        .animated-item.show { opacity: 1; transform: translateY(0); }
        
        .item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 0.75rem 0.75rem 0 0;
            background: #E5E7EB; /* Placeholder Clean Gray */
        }

        .item-image-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            color: rgba(0, 0, 0, 0.3); 
            font-weight: 900;
        }

        .image-upload-zone {
            border: 2px dashed #D1D5DB;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            min-height: 50px;
        }

        .image-upload-zone:hover {
            border-color: var(--tw-colors-2025-primary);
            background: rgba(0, 122, 255, 0.03);
            border-style: solid;
        }

        .card-container {
            position: relative;
            overflow: hidden;
        }
        
        /* Estilos do Perfil */
        #profile-pic {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid #FFFFFF;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .editable-bio {
            min-height: 6rem;
            resize: vertical;
            border: 1px solid transparent;
            padding: 8px;
            border-radius: 8px;
            transition: border-color 0.2s;
        }
        
        .editable-bio:focus {
            outline: none;
            border-color: var(--tw-colors-2025-primary);
            background-color: #F8F9FA;
        }
        
        /* Placeholder para contenteditable */
        [contenteditable][data-placeholder]:empty:before {
            content: attr(data-placeholder);
            color: #9CA3AF;
            pointer-events: none;
        }
        
        [contenteditable]:focus {
            outline: none;
        }
        
        /* Melhor visualiza√ß√£o para cards com imagens */
        .card-container:hover .item-image {
            transform: scale(1.05);
            transition: transform 0.3s ease-out;
        }
        
        .item-image {
            transition: transform 0.3s ease-out;
        }
    </style>
</head>
<body class="antialiased">
    <script>
        const data = {
            '2024': {
                music: [
                    {
                        title: "Di√°rio de um Exclu√≠do - Santtos",
                        score: 8,
                        extra: "(melhor faixa: 'Caf√©')",
                        image: ""
                    },
                    {
                        title: "American Dream - 21 Savage",
                        score: 7.5,
                        image: ""
                    },
                    {
                        title: "Vultures 1 - Kanye West",
                        score: 7,
                        image: ""
                    },
                    {
                        title: "Puterrier (Funk)",
                        score: 8.5,
                        image: ""
                    },
                    {
                        title: "Insano - Kid Cudi",
                        score: 10,
                        best: true,
                        image: ""
                    },
                    {
                        title: "Royal Blu - Blu / Roy Royal",
                        score: 8,
                        image: ""
                    },
                    {
                        title: "2093 - Yeat",
                        score: 4,
                        image: ""
                    },
                    {
                        title: "WE DON'T TRUST YOU - Future - Metro Boomin",
                        score: 0,
                        extra: "Sem nota",
                        image: ""
                    },
                    {
                        title: "Kalledy - Link do zap",
                        score: 9,
                        image: ""
                    },
                    {
                        title: "Dias antes do caos - Alee",
                        score: 7,
                        image: ""
                    }
                ],
                films: [
                    {
                        title: "The Marvels (2023)",
                        score: 0.5,
                        worst: true,
                        type: "Filme",
                        image: ""
                    },
                    {
                        title: "Duna: Parte 2",
                        score: 4,
                        extra: "Bom",
                        type: "Filme",
                        image: ""
                    },
                    {
                        title: "Kung Fu Panda 4",
                        score: 3,
                        extra: "M√©dio",
                        type: "Filme",
                        image: ""
                    }
                ],
                games: []
            },
            '2025': {
                music: [
                    {
                        title: "Timely - Anri",
                        score: 8,
                        image: ""
                    },
                    {
                        title: "Standing Still In A Moving Scene - ÁôæÊôØ",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "Ballonerism - Mac Miller",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "Diamantes, L√°grimas e Rostos para Esquecer - BK",
                        score: 8,
                        image: ""
                    },
                    {
                        title: "What A Devastating Turn of Events - Rachel Chinouriri",
                        score: 7,
                        image: ""
                    },
                    {
                        title: "Hurry Up Tomorrow - The Weeknd",
                        score: 7,
                        image: ""
                    },
                    {
                        title: "Quanto Mais Eu Como, Mais Fome Eu Sinto - Djonga",
                        score: 5,
                        image: ""
                    },
                    {
                        title: "MUSIC - SORRY 4 DA WAIT - Playboi Carti",
                        score: 4,
                        image: ""
                    },
                    {
                        title: "SWAG - Justin Bieber",
                        score: 6,
                        image: ""
                    },
                    {
                        title: "JACKBOYS 2 - travis",
                        score: 2,
                        image: ""
                    },
                    {
                        title: "CARO Vapor II - Don L",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "Eu venci o mundo - Veigh",
                        score: -10,
                        worst: true,
                        image: ""
                    }
                ],
                films: [
                    {
                        title: "Divertidamente 2",
                        score: 4,
                        type: "Filme",
                        image: ""
                    },
                    {
                        title: "Captain America: Brave New World",
                        score: 2,
                        type: "Filme",
                        image: ""
                    },
                    {
                        title: "Sinners",
                        score: 4,
                        type: "Filme",
                        image: ""
                    },
                    {
                        title: "Superman (2025)",
                        score: 4.5,
                        type: "Filme",
                        image: ""
                    },
                    {
                        title: "The Summer I Turned Pretty",
                        score: 5,
                        type: "S√©rie",
                        image: ""
                    },
                    {
                        title: "Peacemaker Season 2",
                        score: 8,
                        best: true,
                        type: "S√©rie",
                        image: ""
                    }
                ],
                games: [
                    {
                        title: "Batman: Arkham City",
                        score: 10,
                        image: "https://pin.it/3DGVruZJ4"
                    },
                    {
                        title: "Devil May Cry 5",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "Hogwarts Legacy",
                        score: 5,
                        image: ""
                    },
                    {
                        title: "The Last of Us Part I",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "BioShock Infinite",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "Resident Evil 4 Remake",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "Lies Of P",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "Miles Morales",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "JEDI FALLEN ORDER",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "South Park: The Fractured But Whole",
                        score: 10,
                        image: ""
                    },
                    {
                        title: "South Park: The Stick of Truth",
                        score: 10,
                        image: ""
                    }
                ]
            }
        };
        
        // Fun√ß√µes de Persist√™ncia LocalStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem('acervoData', JSON.stringify(data));
                localStorage.setItem('acervoProfile', JSON.stringify(profile));
            } catch (e) {
                console.warn('Erro ao salvar no localStorage:', e);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('acervoData');
                const savedProfile = localStorage.getItem('acervoProfile');
                
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    // Mescla dados salvos com estrutura padr√£o
                    Object.keys(parsed).forEach(year => {
                        if (data[year]) {
                            ['games', 'music', 'films'].forEach(cat => {
                                if (parsed[year][cat]) {
                                    parsed[year][cat].forEach((item, idx) => {
                                        if (data[year][cat][idx]) {
                                            // Preserva imagem se existir
                                            if (item.image) {
                                                data[year][cat][idx].image = item.image;
                                            }
                                        }
                                    });
                                }
                            });
                        }
                    });
                    // Atualiza com dados mesclados
                    Object.assign(data, parsed);
                }
                
                if (savedProfile) {
                    profile = JSON.parse(savedProfile);
                }
            } catch (e) {
                console.warn('Erro ao carregar do localStorage:', e);
            }
        }

        let profile = {
            name: "",
            bio: "",
            imageUrl: ""
        };
        
        // Carrega dados salvos antes de inicializar
        loadFromLocalStorage();
        
        // Se n√£o houver perfil salvo, usa valores padr√£o vazios
        if (!profile.name && !profile.bio && !profile.imageUrl) {
            profile = {
                name: "",
                bio: "",
                imageUrl: ""
            };
        }
        
        // --- Fun√ß√µes de Perfil ---
        function loadProfile() {
            const nameEl = document.getElementById('profile-name');
            const bioEl = document.getElementById('profile-bio');
            const picEl = document.getElementById('profile-pic');
            
            if (nameEl) {
                nameEl.textContent = profile.name || "";
            }
            if (bioEl) {
                bioEl.value = profile.bio || "";
            }
            if (picEl) {
                picEl.src = profile.imageUrl || "https://placehold.co/120x120/E5E7EB/4B5563?text=+";
            }
        }

        function handleBioChange(event) {
            profile.bio = event.target.value;
            saveToLocalStorage();
        }

        function handleProfilePicUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    profile.imageUrl = e.target.result;
                    const picEl = document.getElementById('profile-pic');
                    if (picEl) {
                        picEl.src = profile.imageUrl;
                    }
                    saveToLocalStorage();
                };
                reader.readAsDataURL(file);
            }
        }

        function handleNameChange(event) {
            profile.name = event.target.textContent || "";
            saveToLocalStorage();
        }
        // -------------------------

        // Fun√ß√£o para gerar c√≥digo JavaScript formatado do objeto data
        function generateDataCode(obj, indent = 0) {
            const spaces = ' '.repeat(indent * 4);
            if (Array.isArray(obj)) {
                if (obj.length === 0) return '[]';
                let code = '[\n';
                obj.forEach((item, idx) => {
                    code += spaces + '    ' + generateDataCode(item, indent + 1);
                    if (idx < obj.length - 1) code += ',';
                    code += '\n';
                });
                return code + spaces + ']';
            } else if (typeof obj === 'object' && obj !== null) {
                const keys = Object.keys(obj);
                if (keys.length === 0) return '{}';
                let code = '{\n';
                keys.forEach((key, idx) => {
                    const formattedKey = /^\d+$/.test(key) ? `'${key}'` : key;
                    code += spaces + '    ' + formattedKey + ': ' + generateDataCode(obj[key], indent + 1);
                    if (idx < keys.length - 1) code += ',';
                    code += '\n';
                });
                return code + spaces + '}';
            } else if (typeof obj === 'string') {
                // Escape aspas e quebras de linha
                const escaped = obj.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n');
                return `"${escaped}"`;
            } else {
                return String(obj);
            }
        }

        // Fun√ß√µes de Exporta√ß√£o/Importa√ß√£o de Dados
        function exportData() {
            // Garante que os dados est√£o atualizados
            saveToLocalStorage();
            
            const exportObj = {
                data: data,
                profile: profile,
                timestamp: new Date().toISOString()
            };
            
            const jsonStr = JSON.stringify(exportObj, null, 2);
            
            // Gera c√≥digo JavaScript formatado para substitui√ß√£o direta
            const jsCode = `const data = ${generateDataCode(data)};`;
            
            // Cria um modal para exibir o c√≥digo
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl p-6 max-w-6xl w-full max-h-[85vh] overflow-hidden flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-bold text-gray-900">C√≥digo para Atualizar HTML</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">&times;</button>
                    </div>
                    <p class="text-sm text-gray-600 mb-2">
                        üìã <strong>Op√ß√£o 1:</strong> Clique em "Atualizar Automaticamente" e me envie a mensagem que aparecer<br>
                        üíæ <strong>Op√ß√£o 2:</strong> Copie o c√≥digo abaixo e cole aqui na conversa para eu atualizar o arquivo
                    </p>
                    <textarea id="export-code" class="w-full h-96 p-4 border-2 border-gray-300 rounded-lg font-mono text-xs resize-none" readonly>${jsCode}</textarea>
                    <div class="flex gap-3 mt-4 flex-wrap">
                        <button onclick="updateFileAutomatically()" class="flex-1 min-w-[200px] bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                            ü§ñ Atualizar Automaticamente
                        </button>
                        <button onclick="copyExportCode()" class="flex-1 min-w-[200px] bg-2025-primary text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                            üìã Copiar C√≥digo
                        </button>
                        <button onclick="downloadExportFile()" class="flex-1 min-w-[200px] bg-gray-200 text-gray-700 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 transition-colors">
                            üíæ Baixar JSON
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="px-6 py-3 rounded-lg font-semibold border-2 border-gray-300 hover:bg-gray-50 transition-colors">
                            Fechar
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Salva refer√™ncias para uso nas fun√ß√µes
            window.currentExportData = jsonStr;
            window.currentJSCode = jsCode;
        }

        function updateFileAutomatically() {
            // Garante dados atualizados
            saveToLocalStorage();
            
            // Pega dados do localStorage (fonte de verdade)
            const savedData = localStorage.getItem('acervoData');
            const savedProfile = localStorage.getItem('acervoProfile');
            
            if (!savedData) {
                alert('‚ùå Nenhum dado encontrado no navegador. Adicione algumas imagens primeiro!');
                return;
            }
            
            try {
                const dataObj = JSON.parse(savedData);
                const profileObj = savedProfile ? JSON.parse(savedProfile) : profile;
                
                // Gera c√≥digo JavaScript formatado
                const dataCode = generateDataCode(dataObj);
                const profileCode = generateDataCode(profileObj);
                
                const fullCode = `// Dados atualizados - Cole isso para o assistente atualizar o arquivo\n\nconst data = ${dataCode};\n\nlet profile = ${profileCode};`;
                
                // Copia para √°rea de transfer√™ncia
                navigator.clipboard.writeText(fullCode).then(() => {
                    // Mostra instru√ß√µes
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                    modal.innerHTML = `
                        <div class="bg-white rounded-2xl p-6 max-w-2xl w-full">
                            <div class="text-center">
                                <div class="text-6xl mb-4">ü§ñ</div>
                                <h3 class="text-2xl font-bold text-gray-900 mb-4">C√≥digo Copiado!</h3>
                                <p class="text-gray-600 mb-6">
                                    O c√≥digo com seus dados atualizados foi copiado para a √°rea de transfer√™ncia.<br><br>
                                    <strong>Agora √© s√≥ me avisar: "atualize o arquivo com os dados copiados"</strong><br><br>
                                    Ou cole o c√≥digo aqui na conversa que eu atualizo para voc√™!
                                </p>
                                <button onclick="this.closest('.fixed').remove()" 
                                        class="bg-2025-primary text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                                    Entendi, fechar
                                </button>
                            </div>
                        </div>
                    `;
                    document.body.appendChild(modal);
                    
                    // Tamb√©m salva globalmente para f√°cil acesso
                    window.dataForUpdate = fullCode;
                    
                    console.log('%c‚úÖ C√ìDIGO COPIADO!', 'color: green; font-size: 20px; font-weight: bold;');
                    console.log('%cAgora avise: "atualize o arquivo com os dados copiados"', 'color: blue; font-size: 14px;');
                    console.log('Ou execute: copy(window.dataForUpdate) para copiar novamente');
                }).catch(() => {
                    alert('N√£o foi poss√≠vel copiar automaticamente. O c√≥digo est√° no campo de texto acima.');
                });
            } catch (e) {
                alert('Erro ao processar dados: ' + e.message);
            }
        }

        function copyExportCode() {
            const textarea = document.getElementById('export-code');
            if (textarea) {
                textarea.select();
                document.execCommand('copy');
                
                // Feedback visual
                const btn = event.target.closest('button');
                const originalText = btn.textContent;
                btn.textContent = '‚úì Copiado!';
                btn.classList.add('bg-green-500');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('bg-green-500');
                }, 2000);
            }
        }

        function downloadExportFile() {
            if (!window.currentExportData) return;
            
            const blob = new Blob([window.currentExportData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `acervo-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'application/json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const imported = JSON.parse(e.target.result);
                            
                            if (imported.data) {
                                // Mescla dados importados
                                Object.keys(imported.data).forEach(year => {
                                    if (data[year]) {
                                        ['games', 'music', 'films'].forEach(cat => {
                                            if (imported.data[year][cat]) {
                                                imported.data[year][cat].forEach((item, idx) => {
                                                    if (data[year][cat][idx] && item.image) {
                                                        data[year][cat][idx].image = item.image;
                                                    }
                                                });
                                            }
                                        });
                                    }
                                });
                            }
                            
                            if (imported.profile) {
                                profile = imported.profile;
                            }
                            
                            saveToLocalStorage();
                            loadProfile();
                            renderAllDetails();
                            renderStats();
                            renderGraph();
                            initializeIntersectionObserver();
                            
                            alert('‚úÖ Dados importados com sucesso!');
                        } catch (err) {
                            alert('‚ùå Erro ao importar: ' + err.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function normalizeScore(item, isFilm) {
            let score = item.score;
            if (isFilm) {
                // Normaliza scores de filmes/s√©ries para 10
                if (item.title.includes("Duna: Parte 2")) return 8; 
                if (item.title.includes("Kung Fu Panda 4")) return 6; 
                if (item.score <= 5 && item.score > 0 && item.type === "Filme") return item.score * 2;
                if (item.score === 0.5) return 1; 
            }
            // Garante que o score nunca seja negativo para o c√°lculo da m√©dia
            return Math.max(0, score);
        }

        function calculateStats(yearData) {
            let totalItems = 0, totalScore = 0, countScores = 0, countTen = 0;
            const counts = { games: yearData.games.length, music: yearData.music.length, films: yearData.films.length };
            const averages = {};

            ['games', 'music', 'films'].forEach(cat => {
                let sum = 0, count = 0;
                const isFilm = cat === 'films';

                yearData[cat].forEach(item => {
                    totalItems++;
                    const score = normalizeScore(item, isFilm);
                    
                    if (score >= 0 && item.extra !== "Sem nota") {
                        totalScore += score;
                        countScores++;
                        sum += score;
                        count++;
                    }
                    if (score === 10) countTen++;
                });
                averages[cat] = count > 0 ? (sum / count).toFixed(2) : 0;
            });

            const totalAverage = countScores > 0 ? (totalScore / countScores).toFixed(2) : 0;
            return { totalItems, totalAverage, counts, averages, countTen };
        }

        const stats2024 = calculateStats(data['2024']);
        const stats2025 = calculateStats(data['2025']);

        // Substitu√≠ os emojis por letras para o placeholder
        function getIconForCategory(category) {
            const icons = {
                games: 'G', 
                music: 'M', 
                films: 'F'
            };
            return icons[category] || 'P';
        }

        function renderStats() {
            // C√°lculo da diferen√ßa de m√©dia
            const diffAvg = (stats2025.totalAverage - stats2024.totalAverage).toFixed(2);
            let avgColor = 'text-gray-600';
            let avgIcon = '';
            if (diffAvg > 0) {
                avgColor = 'text-high-score'; 
                avgIcon = '‚Üë';
            } else if (diffAvg < 0) {
                avgColor = 'text-low-score'; 
                avgIcon = '‚Üì';
            }

            document.getElementById('stats-container').innerHTML = `
                <div class="apple-card p-8 rounded-3xl border-l-4 border-2025-primary animated-item">
                    <p class="text-xl font-semibold text-gray-700 mb-4">Total de Itens</p>
                    <div class="flex justify-between items-end">
                        <div><span class="text-3xl font-bold text-2024-primary">2024:</span> <span class="text-5xl font-black text-gray-900">${stats2024.totalItems}</span></div>
                        <div><span class="text-3xl font-bold text-2025-primary">2025:</span> <span class="text-6xl font-black text-gray-900">${stats2025.totalItems}</span></div>
                    </div>
                    <p class="text-sm mt-3 ${stats2025.totalItems > stats2024.totalItems ? 'text-high-score font-medium' : 'text-gray-500'}">
                        ${stats2025.totalItems > stats2024.totalItems ? '‚Üë' : ''} ${Math.abs(stats2025.totalItems - stats2024.totalItems)} itens ${stats2025.totalItems > stats2024.totalItems ? 'a mais' : 'a menos'} em 2025
                    </p>
                </div>

                <div class="apple-card p-8 rounded-3xl border-l-4 border-2024-primary animated-item">
                    <p class="text-xl font-semibold text-gray-700 mb-4">M√©dia Geral</p>
                    <div class="flex justify-between items-end">
                        <div><span class="text-3xl font-bold text-2024-primary">2024:</span> <span class="text-5xl font-black score-${Math.round(stats2024.totalAverage)}">${stats2024.totalAverage}</span></div>
                        <div><span class="text-3xl font-bold text-2025-primary">2025:</span> <span class="text-6xl font-black score-${Math.round(stats2025.totalAverage)}">${stats2025.totalAverage}</span></div>
                    </div>
                    <p class="text-sm mt-3 ${avgColor} font-medium">${avgIcon} ${Math.abs(diffAvg)} de diferen√ßa em 2025</p>
                </div>

                <div class="apple-card p-8 rounded-3xl border-l-4 border-high-score animated-item">
                    <p class="text-xl font-semibold text-gray-700 mb-4">Notas Perfeitas</p>
                    <div class="flex justify-between items-end">
                        <div><span class="text-3xl font-bold text-2024-primary">2024:</span> <span class="text-5xl font-black text-high-score">${stats2024.countTen}</span></div>
                        <div><span class="text-3xl font-bold text-2025-primary">2025:</span> <span class="text-6xl font-black text-high-score">${stats2025.countTen}</span></div>
                    </div>
                    <p class="text-sm mt-3 text-high-score font-medium"># ${stats2025.countTen} Notas 10/10 em 2025</p>
                </div>
            `;
        }
        
        function renderGraph() {
            const maxCount = Math.max(stats2024.totalItems, stats2025.totalItems, 10); 
            let html = '';

            const categories = [
                { id: 'games', label: 'Jogos' }, 
                { id: 'music', label: 'M√∫sicas' }, 
                { id: 'films', label: 'Filmes/S√©ries' } 
            ];

            categories.forEach(cat => {
                const count2024 = stats2024.counts[cat.id];
                const count2025 = stats2025.counts[cat.id];
                const width2024 = count2024 > 0 ? Math.max(5, (count2024 / maxCount) * 100) : 0;
                const width2025 = count2025 > 0 ? Math.max(5, (count2025 / maxCount) * 100) : 0;

                const avg2024 = stats2024.averages[cat.id];
                const avg2025 = stats2025.averages[cat.id];
                const diffAvgCat = (avg2025 - avg2024).toFixed(2);
                let avgCatColor = 'text-gray-600';
                let avgCatIcon = '';
                if (diffAvgCat > 0) { avgCatColor = 'text-high-score'; avgIcon = '‚Üë'; } 
                else if (diffAvgCat < 0) { avgCatColor = 'text-low-score'; avgIcon = '‚Üì'; }

                html += `
                    <div class="mb-8 animated-item">
                        <div class="flex justify-between items-center mb-1">
                            <h3 class="text-2xl font-bold text-gray-800">${cat.label}</h3>
                            <span class="text-sm font-semibold ${avgCatColor}">${avgCatIcon} ${Math.abs(diffAvgCat)} (M√©dia)</span>
                        </div>
                        <div class="space-y-3">
                            <!-- Barra 2024 (Roxo) -->
                            <div class="flex items-center">
                                <span class="text-sm font-medium w-16 text-2024-primary">2024 (${avg2024})</span>
                                <div class="flex-grow bg-gray-200 rounded-full h-7 relative">
                                    <div class="bar-fill h-full rounded-full bg-2024-primary/80 shadow-md" style="--bar-width: ${width2024}%;"></div>
                                </div>
                                <span class="ml-3 text-lg font-bold w-8 text-right text-gray-700">${count2024}</span>
                            </div>
                            <!-- Barra 2025 (Azul) -->
                            <div class="flex items-center">
                                <span class="text-sm font-medium w-16 text-2025-primary">2025 (${avg2025})</span>
                                <div class="flex-grow bg-gray-200 rounded-full h-7 relative">
                                    <div class="bar-fill h-full rounded-full bg-2025-primary/80 shadow-md" style="--bar-width: ${width2025}%;"></div>
                                </div>
                                <span class="ml-3 text-lg font-bold w-8 text-right text-gray-700">${count2025}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('comparison-graph').innerHTML = html;
        }

        function renderCard(item, year, category, index) {
            const isFilm = category === 'films';
            const scoreValue = normalizeScore(item, isFilm);
            const rawScore = item.score; // Score original
            const scoreClass = `score-${Math.max(0, Math.round(scoreValue))}`;
            const barWidth = Math.max(5, (scoreValue / 10) * 100);
            const yearColor = year === '2024' ? '2024-primary' : '2025-primary';
            const icon = getIconForCategory(category);
            
            // Texto da nota normalizada para o c√°lculo (sempre /10)
            const normalizedScoreText = scoreValue >= 0 ? `${scoreValue.toFixed(1)}/10` : 'S/N';
            const normalizedScoreClass = `score-${Math.max(0, Math.round(scoreValue))}`;

            // Define o formato de exibi√ß√£o do score na UI (raw score / formato original)
            let scoreVisual = '';
            let rawScoreText = '';

            if (isFilm && (item.type === "Filme" || item.type === "S√©rie")) {
                const maxStars = 5; 
                const currentStars = item.score;
                
                for (let i = 1; i <= maxStars; i++) {
                    if (i <= currentStars) {
                        scoreVisual += '<span class="star-filled text-2xl">‚òÖ</span>'; 
                    } else if (i === Math.ceil(currentStars) && currentStars % 1 !== 0) {
                        scoreVisual += '<span class="text-yellow-300 text-2xl">‚òÖ</span>'; 
                    }
                    else {
                        scoreVisual += '<span class="star-empty text-2xl">‚òÖ</span>'; 
                    }
                }
                rawScoreText = `${item.score}/${maxStars} ${item.type}`;
            } else {
                // Score de 0 a 10 (M√∫sica e Jogos)
                scoreVisual = `
                    <div class="w-full h-2 rounded-full bg-gray-200">
                        <div class="h-full rounded-full transition-all duration-1000" style="width: ${barWidth}%; background-color: ${scoreValue >= 8 ? '#34C759' : scoreValue >= 6 ? '#FFCC00' : scoreValue >= 4 ? '#FF9500' : '#FF3B30'};"></div>
                    </div>
                `;
                rawScoreText = `${rawScore}/10`;
            }

            const imageHtml = item.image 
                ? `<img src="${item.image}" alt="${item.title}" class="item-image" loading="lazy" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\\'item-image item-image-placeholder\\'>${icon}</div>';" />`
                : `<div class="item-image item-image-placeholder" style="background: linear-gradient(135deg, #E5E7EB 0%, #F3F4F6 100%);">${icon}</div>`;

            return `
                <div class="apple-card rounded-2xl overflow-hidden animated-item card-container">
                    <div class="relative">
                        ${imageHtml}
                        <div class="absolute top-3 left-3 right-3 flex justify-between items-start z-10">
                            <span class="text-xs font-bold text-white bg-${yearColor} px-2 py-1 rounded-full shadow-sm">${year}</span>
                            <div class="flex gap-2">
                                <!-- √çcones substitu√≠dos por texto simples com cores -->
                                ${item.best ? '<span class="text-xs font-medium bg-high-score text-white px-2 py-1 rounded-full shadow-sm">DESTAQUE</span>' : ''}
                                ${item.worst ? '<span class="text-xs font-medium bg-low-score text-white px-2 py-1 rounded-full shadow-sm">PIOR NOTA</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="p-6 flex flex-col h-full text-gray-800">
                        <h3 class="text-lg font-semibold mb-1 line-clamp-2 min-h-[3.5rem] text-gray-800">${item.title}</h3>
                        ${item.extra ? `<p class="text-xs text-gray-500 mb-2">${item.extra}</p>` : ''}
                        
                        <!-- Nota normalizada /10 -->
                        <div class="mt-2 mb-3">
                            <span class="text-xs font-medium text-gray-600">Nota para Comparativo: </span>
                            <span class="text-md font-bold ${normalizedScoreClass}">${normalizedScoreText}</span>
                        </div>
                        
                        <div class="mt-auto pt-4 border-t border-gray-200">
                            <div class="flex items-center justify-between mb-2 mt-2">
                                <!-- SCORE BRUTO / FORMATO ORIGINAL -->
                                <span class="text-xl font-black ${scoreClass} text-gray-800">${rawScoreText}</span>
                            </div>
                            ${scoreVisual}
                        </div>
                        
                        <!-- Zona de upload de imagem para cada item -->
                        <div class="mt-4 pt-3 border-t border-gray-100">
                            <label class="image-upload-zone p-3 block text-center text-xs font-medium text-gray-600 hover:text-2025-primary transition-colors cursor-pointer w-full">
                                <input type="file" class="hidden image-input" accept="image/*" data-year="${year}" data-category="${category}" data-index="${index}">
                                ${item.image ? '<span class="text-green-600 font-semibold">‚úì Foto adicionada</span><br><span class="text-xs text-gray-500">Clique para trocar</span>' : '<span class="text-gray-500">üì∑ Adicionar foto</span>'}
                            </label>
                        </div>
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o para renderizar detalhes de uma categoria espec√≠fica (por ano)
        function renderCategoryDetails(year, cat) {
            const container = document.getElementById(`details-${year}-${cat}`);
            if (!container) return;

            // Filtra e ordena os itens apenas para o ano e categoria especificados
            const sortedItems = data[year][cat]
                .map((item, i) => ({ item, year: year, index: i }))
                .sort((a, b) => {
                    const scoreA = normalizeScore(a.item, cat === 'films');
                    const scoreB = normalizeScore(b.item, cat === 'films');
                    return scoreB - scoreA;
                });

            container.innerHTML = sortedItems.map(obj => renderCard(obj.item, obj.year, cat, obj.index)).join('');

            // Anexa event listeners aos inputs de imagem ap√≥s renderizar
            container.querySelectorAll('.image-input').forEach(input => {
                input.addEventListener('change', function(event) {
                    const year = this.dataset.year;
                    const category = this.dataset.category;
                    const index = parseInt(this.dataset.index);
                    handleImageUpload(event, year, category, index);
                });
            });

            // Se a se√ß√£o est√° vazia, adiciona uma mensagem
            if (sortedItems.length === 0) {
                 const catLabel = cat === 'films' ? 'Filmes/S√©ries' : cat === 'music' ? 'M√∫sicas' : 'Jogos';
                 container.innerHTML = `
                    <div class="col-span-full p-8 text-center text-gray-400 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300">
                        <p class="text-lg font-medium">Nenhum ${catLabel.toLowerCase()} registrado em ${year}</p>
                    </div>
                 `;
            }
        }

        // Nova fun√ß√£o para renderizar todos os detalhes (substitui renderDetails)
        function renderAllDetails() {
            ['games', 'music', 'films'].forEach(cat => {
                renderCategoryDetails('2025', cat);
                renderCategoryDetails('2024', cat);
            });
        }
        
        function handleImageUpload(event, year, category, index) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Salva a imagem no objeto data
                    data[year][category][index].image = e.target.result;
                    
                    // Salva no localStorage
                    saveToLocalStorage();
                    
                    // Re-renderiza tudo para atualizar a interface
                    renderAllDetails();
                    renderStats();
                    renderGraph();

                    // Animar o card atualizado (reinicializando o observador)
                    setTimeout(() => {
                        initializeIntersectionObserver();
                    }, 100);
                };
                reader.onerror = function() {
                    alert('Erro ao carregar a imagem. Tente novamente.');
                };
                reader.readAsDataURL(file);
            }
        }

        function initializeIntersectionObserver() {
             // Remove 'show' class to reset animations
            document.querySelectorAll('.animated-item').forEach(item => item.classList.remove('show'));

            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('show');
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            document.querySelectorAll('.animated-item').forEach(item => observer.observe(item));
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Carrega dados salvos primeiro
            loadFromLocalStorage();
            
            loadProfile();
            renderStats();
            renderGraph();
            renderAllDetails();
            initializeIntersectionObserver();
            
            // Salva automaticamente quando o nome do perfil √© editado
            const nameEl = document.getElementById('profile-name');
            if (nameEl) {
                nameEl.addEventListener('blur', handleNameChange);
                nameEl.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.blur();
                    }
                });
            }
        });
    </script>

    <header class="pt-20 pb-16 px-4 md:px-8 lg:px-16 bg-white border-b border-gray-100 shadow-sm">
        <div class="max-w-7xl mx-auto">
            <!-- T√≠tulo Principal - Light Weight, Huge Size -->
            <h1 class="text-6xl md:text-8xl mb-2 tracking-tighter apple-header-text fade-in" style="font-weight: 300;">
                Meu Acervo
            </h1>
            <!-- Subt√≠tulo - Bold, Medium Size -->
            <h2 class="text-3xl md:text-5xl font-semibold mb-4 tracking-tight slide-up text-gray-900">
                O Mundinho do Consumo Cultural
            </h2>
            <!-- Descri√ß√£o -->
            <p class="text-xl md:text-2xl text-gray-600 font-normal mt-4 slide-up" style="animation-delay: 0.2s;">
                Uma retrospectiva do consumo cultural ao longo dos anos.
            </p>
        </div>
    </header>

    <main>
        <!-- NOVO: Se√ß√£o de Perfil -->
        <section class="max-w-7xl mx-auto px-4 md:px-8 lg:px-16 py-12">
            <div class="apple-card p-8 rounded-3xl flex flex-col md:flex-row items-center gap-8">
                
                <!-- Coluna da Foto -->
                <div class="flex flex-col items-center">
                    <label for="pic-upload" class="cursor-pointer group">
                        <div class="relative">
                            <img id="profile-pic" 
                                 src="https://placehold.co/120x120/E5E7EB/4B5563?text=+" 
                                 alt="Foto de Perfil"
                                 class="mb-3 group-hover:opacity-80 transition-opacity" />
                            <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black bg-opacity-20 rounded-full mb-3">
                                <span class="text-white text-xs font-medium">üì∑</span>
                            </div>
                        </div>
                        <input type="file" id="pic-upload" class="hidden" accept="image/*" onchange="handleProfilePicUpload(event)">
                        <p class="text-sm text-gray-500 font-medium text-center hover:text-2025-primary transition-colors">Adicionar foto</p>
                    </label>
                </div>
                
                <!-- Coluna do Nome e Bio -->
                <div class="flex-grow text-center md:text-left">
                    <!-- Nome Edit√°vel -->
                    <h2 id="profile-name" contenteditable="true" 
                        class="text-3xl sm:text-4xl font-bold mb-3 text-gray-900 hover:text-2025-primary transition-colors cursor-text focus:outline-none focus:ring-2 focus:ring-2025-primary focus:ring-opacity-50 rounded px-2"
                        data-placeholder="Seu nome"
                    ></h2>
                    
                    <!-- Bio Edit√°vel -->
                    <textarea id="profile-bio" 
                              class="w-full text-gray-700 editable-bio"
                              oninput="handleBioChange(event)"
                              placeholder="Conte um pouco sobre voc√™, seus gostos culturais, o que te inspira..."
                    ></textarea>
                </div>
            </div>
        </section>
        
        <!-- Vis√£o Geral -->
        <section class="max-w-7xl mx-auto px-4 md:px-8 lg:px-16 py-10">
            <h2 class="text-3xl font-semibold mb-8 text-2025-primary">Vis√£o Geral</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="stats-container"></div>
        </section>

        <!-- Comparativo -->
        <section class="max-w-7xl mx-auto px-4 md:px-8 lg:px-16 mb-16">
            <h2 class="text-3xl font-semibold mb-8 text-2024-primary">Comparativo por Categoria</h2>
            <div class="apple-card p-8 rounded-3xl" id="comparison-graph"></div>
        </section>

        <!-- Detalhes dos Itens ANO 2025 -->
        <section class="max-w-7xl mx-auto px-4 md:px-8 lg:px-16 mb-20">
            <h2 class="text-4xl font-semibold mb-10 border-b-4 pb-4 border-2025-primary text-2025-primary">RETROSPECTIVA 2025</h2>

            <h3 class="text-3xl font-medium mb-8 border-b border-gray-300 pb-2 text-gray-700">Jogos (Ordenado por Nota)</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12" id="details-2025-games"></div>

            <h3 class="text-3xl font-medium mb-8 border-b border-gray-300 pb-2 text-gray-700">M√∫sicas (Ordenado por Nota)</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12" id="details-2025-music"></div>

            <h3 class="text-3xl font-medium mb-8 border-b border-gray-300 pb-2 text-gray-700">Filmes & S√©ries (Ordenado por Nota)</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="details-2025-films"></div>
        </section>

        <!-- Detalhes dos Itens ANO 2024 -->
        <section class="max-w-7xl mx-auto px-4 md:px-8 lg:px-16 mb-20">
            <h2 class="text-4xl font-semibold mb-10 border-b-4 pb-4 border-2024-primary text-2024-primary">RETROSPECTIVA 2024</h2>

            <h3 class="text-3xl font-medium mb-8 border-b border-gray-300 pb-2 text-gray-700">Jogos (Ordenado por Nota)</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12" id="details-2024-games"></div>

            <h3 class="text-3xl font-medium mb-8 border-b border-gray-300 pb-2 text-gray-700">M√∫sicas (Ordenado por Nota)</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12" id="details-2024-music"></div>

            <h3 class="text-3xl font-medium mb-8 border-b border-gray-300 pb-2 text-gray-700">Filmes & S√©ries (Ordenado por Nota)</h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6" id="details-2024-films"></div>
        </section>
    </main>
</body>
</html>
